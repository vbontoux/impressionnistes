# Deployment Checklist

## Pre-Deployment

- [ ] AWS CLI installed and configured
- [ ] AWS CDK CLI installed (`npm install -g aws-cdk`)
- [ ] Python 3.11+ installed
- [ ] AWS credentials configured with appropriate permissions
- [ ] Virtual environment created and activated
- [ ] Python dependencies installed in virtual environment

## First-Time Setup

- [ ] Create virtual environment: `python3 -m venv venv`
- [ ] Activate virtual environment: `source venv/bin/activate`
- [ ] Install dependencies: `pip install -r requirements.txt`
- [ ] Bootstrap CDK: `cdk bootstrap --context env=dev`
- [ ] Verify synthesis: `cdk synth --context env=dev`
- [ ] Review generated CloudFormation templates in `cdk.out/`

## Development Deployment

- [ ] Run `cdk diff --context env=dev` to preview changes
- [ ] Deploy: `./deploy.sh dev` or `cdk deploy --all --context env=dev`
- [ ] Verify stack outputs
- [ ] Test deployed resources

## Production Deployment

- [ ] Code review completed
- [ ] All tests passing
- [ ] Backup existing production data
- [ ] Run `cdk diff --context env=prod` to preview changes
- [ ] Deploy: `./deploy.sh prod`
- [ ] Verify deployment
- [ ] Run smoke tests
- [ ] Monitor CloudWatch logs and alarms

## Post-Deployment

- [ ] Verify all stacks deployed successfully
- [ ] Check CloudWatch logs for errors
- [ ] Test API endpoints
- [ ] Verify frontend is accessible
- [ ] Check DynamoDB table is created
- [ ] Confirm monitoring alarms are active

## Rollback Procedure

If deployment fails:

1. Check CloudFormation events: `aws cloudformation describe-stack-events --stack-name <stack-name>`
2. Review error messages
3. Fix issues in code
4. Redeploy or rollback: `cdk deploy --rollback`

## Stack Order

Stacks are deployed in this order (managed automatically by CDK):

1. DatabaseStack (no dependencies)
2. MonitoringStack (no dependencies)
3. ApiStack (depends on DatabaseStack)
4. FrontendStack (depends on ApiStack)

## Environment Variables

Required:
- `CDK_DEFAULT_ACCOUNT` (auto-detected from AWS credentials)
- `CDK_DEFAULT_REGION` (default: eu-west-3)

Optional:
- `AWS_PROFILE` (if using named AWS profiles)

## Troubleshooting

### CDK Bootstrap Issues
```bash
cdk bootstrap aws://ACCOUNT-ID/eu-west-3
```

### Permission Denied
Ensure IAM user/role has permissions for:
- CloudFormation
- DynamoDB, Lambda, API Gateway, S3, CloudFront
- IAM (for role creation)
- CloudWatch, SNS

### Stack Already Exists
```bash
cdk deploy --force --context env=dev
```

### Clean Slate
```bash
cdk destroy --all --context env=dev
rm -rf cdk.out
cdk deploy --all --context env=dev
```
